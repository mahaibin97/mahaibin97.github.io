Network-basic
==============

### 网络的概念
[计算机网络](https://en.wikipedia.org/wiki/Computer_network)，指的是由两台或者两台以上计算机设备，通过通讯线路连接起来，并在通信协议和网络软件的管理下，进行资源共享和信息传递的计算机系统。

eg.两台终端PC机同时连接在一台集线器（HUB）上，就组成了最简单的一个计算机网络。 

随着[互联网](https://en.wikipedia.org/wiki/Internet)的出现和发展，计算机网络的概念早已经被重新定义，网络真正成为了基础设施。

现在来看，网络就是一个实现'数据传输'与'文件共享'的基础，是实现通讯、电商、游戏等业务的平台。

##### 计算机网络史
第一代：远程终端连接
第二代：计算机网络阶段（局域网）
第三代：计算机网络互联阶段
第四代：信息高速公路（高速，多业务，大数据量）

##### 网络的分类
1）按地理范围分
局域网（LAN   local area network），近距离计算机网络，覆盖范围几米到数公里，例如，常见的办公室、实验室网络，校园网等。
城域网（MAN  Metropolitan Area Network），城市范围内的高速网络，覆盖范围几十公里，介于局域网与广域网之间，例如银川市网络。
广域网（WAN  wide area network），有效覆盖几十公里到几千公里，覆盖整个国家、地区或形成国际远程网络，例如我国的电话交换网。
Internet（因特网），用网络设备将各种类型的LAN、WAN、MAN互联起来，形成了网中网，就是被称为互联网的Internet网。互联网的出现，使得计算机网络从局部局部到全国进而将全世界连成一片。

2）网络还可以按照拓扑来分类，按照传输介质来分类，按照通信协议来分类等等。


### 互联网 Internet
互联网始于1969年美国的[阿帕网](https://baike.baidu.com/item/%E9%98%BF%E5%B8%95%E7%BD%91/1950726?fr=aladdin)。是网络与网络之间所串连成的庞大网络，这些网络以一组通用的协议相连，形成逻辑上的单一巨大国际网络。通常internet泛指互联网，而Internet则特指因特网。这种将计算机网络互相联接在一起的方法可称作“网络互联”，在这基础上发展出覆盖全世界的全球性互联网络称互联网，即是互相连接一起的网络结构。

### OSI七层模型
[OSI](https://en.wikipedia.org/wiki/Open_Systems_Interconnection)（Open system interconnection 开放系统互联）七层网络模型是由[ISO](https://en.wikipedia.org/wiki/International_Organization_for_Standardization)（国际标准化组织）根据各设备厂商的标准开发出来的一套网络架构的标准。

###### 7层 Application 应用层
为应用软件提供接口，使用用程序能够使用网络服务。
> OS  操作系统
> APP 应用软件
'数据在7层是以data的形式传递。'

###### 6层 Presentation 表示层
数据的解码和编码。
'数据在6层是以data的形式传递'

###### 5层 Session 会话层
建立、管理、维护会话。
'数据在5层是以data的形式传递'

###### 4层 Transportation 传输层
服务点编址，分段与重组，链接控制，流量差错控制。
'数据在4层是以段的形式传递的'
该层使用的协议时TCP和UDP。

###### 3层 Internet 网络层
为网络设备提供逻辑地址，进行路由选择，分组转发。
给网络设备提供IP，利用IP寻找路径（路由）。
'数据在该层是以分组的形式传递的'
该层使用的协议时IP协议。

###### 2层 data link 数据链路层
组帧、物理编址、流量控制和差错接入控制。
为设备提供MAC地址，利用MAC寻找路径（交换）。
'数据在该层是以帧的形式传递'

###### 1层 Physical 物理层
定义接受二进制信号，定义接口和媒体的物理特性。
定义网络物理拓扑。
'数据在该层以bite的形式传递'
> 一个数据包的大小是1.54M。

### TCP/IP协议栈

###### 4层 Application 应用层
###### 3层 Transportation 传输层
###### 2层 Internet 网络层
###### 1层 Data link & Physical 网络接入层

#### PDU（protocol data unit）
协议数据单元

|  OSI层数     |  类型  |
|  -----       |  ----  |
|  上三层      |  data  |
|  传输层      |  段    |
|  网络层      |  分组  |
|  数据链路层  |  帧    |
|  物理层      |  bit   |

#### port-ID端口号
在网络技术中，端口（Port）包括逻辑端口和物理端口两种类型。
'端口号有65536个，0-65535'

逻辑端口对应着不同的服务、协议等，比如FTP对应的21号端口，TCP的23号端口，HTTP的80端口。

#### 三次握手

###### 第一次
第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。
###### 第二次
第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；
###### 第三次
第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。

#### [四次挥手](https://baike.baidu.com/item/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/7794287?fr=aladdin)
1） TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送.
2） 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。
3） 服务器关闭客户端的连接，发送一个FIN给客户端。
4） 客户端发回ACK报文确认，并将确认序号设置为收到序号加1。

#### 滑动窗口机制
为了让数据发送变得更平滑。
> 滑动窗口协议的基本原理就是在任意时刻，发送方都维持了一个连续的允许发送的帧的序号，称为发送窗口；同时，接收方也维持了一个连续的允许接收的帧的序号，称为接收窗口。

#### 数据封装与解封装的过程

| PC1  |  OSI层  | 数据类型 | PC2  |
| ---- | -----   | -------  | ---- |
| 主机 |  上三层 |  data    | 主机 |
| IP   |  传输层 |  段      | IP   |
| MAC  |  网络层 |  分组    | MAC  |
|      |  网络层 |  帧      |      |
|      |  物理层 |  bit     |      |


### 网络设备
网络设备及部件是连接到网络中的物理实体。网络设备的种类繁多，且与日俱增。
基本的网络设备有：计算机（无论其为个人电脑或服务器）、集线器、交换机、网桥、路由器、网关、网络接口卡（NIC）、无线接入点（WAP）、打印机和调制解调器、光纤收发器、光缆等。

其中，介质有：
双绞线（存在两种线序）
>1）橙蓝绿棕 & 绿蓝橙棕；
>2）半色在前，全色在后；
>3）3，5交换；
同轴电缆
光纤

常见的以太网接口类型有RJ-45接口，RJ-11接口，SC光纤接口，FDDI接口，AUI接口，BNC接口，Console接口。

### IP地址
###### 1.IP地址有32位
32位（二进制），每8位分段，为4段。
192.168.32.1
1100 0000 | 1010 1000 | 0010 0000 | 0000 0001
“点分十进制”

###### 分类
基于第一段的范围来划分：
A 1-126
127.X.X.X 测试
B 128-191
C 192-223
D 224-239 组播地址 
E 240-255 科研、特殊机构专用，用于实验

>！！补充
数据包的发送方式：
单播：一对一
组播：限定范围，一个组内
广播：一对多

>！！！注意
同一个网络当中，IP地址必须唯一。

###### 公有地址、私有地址
IEEE拥有IP的所有权。
私有地址：
10.0.0.0- - -10.255.255.255
172.16.0.0- - -172.31.255.255
192.168.0.0- - -192.168.255.255

###### 按照使用方法的分类：
网络（段）地址：网络位全为1，主机位全为0的IP地址为该地址段的网段地址；
主机地址：设备真正使用的地址；
广播地址：主机位全为1的IP地址为该网段的广播地址；

###### 子网掩码
规定网络位的大小
129.168.31.1  255.255.255.0
通过IP和子网掩码的配合使用，确定网络类型。
```
子网掩码对应为 1 ，IP位就是所谓的网络位；子网掩码为 0的部分对应的就是主机位。

注： 子网掩码为 0 的IP不能全为 0，全为0的IP是网络IP，不是主机IP；
子网掩码为 0 的部分IP也不能全为 1 ，否则为广播地址，广播地址代表所有人。
```

###### VLSM[可变长子网掩码]
作用：划分子网，有效利用公网IP；

子网与划分子网
借助主机位充当网络位，形成新的网络。
    192.168.1.0/24      192.168.1.  0000 0000
    192.168.1.0/25   192.168.1.0  000 0000   
    借一位变成网络位，形成2个子网，每个子网都有126个主机地址；

```
【实例】一个公司有制造部（111台主机）、财务部（60台主机）、工程部（20台主机）
		Internet分该公司的网络为：192.168.1.0/24，如何给他们分配IP地址？
			
1）首先看需求最大的制造部 111台主机，那么久可以借一位主机位，分出一个子网给他们用
即，192.168.1.0000 0000 /24   分成192.168.1.0000 0000/25 和192.168.1.1000 0000/25
将192.168.1.0/25分给制造部 ，该部可用IP：192.168.1.1~192.168.1.127

2）再将第一步剩下的192.168.1.1000 0000进行分配，再看需求第二的财务部60台，
可再借以为主机位 产生了192.168.1.10  000000 /26和192.168.1.11 000000/26
将192.168.1.128/26分给财务部，该部可用IP：192.168.1.128~192.168.1.191

3）再将第二步剩下的192.168.1.11  000000进行分配，最后看工程部的需求，
可以在借一位主机位，产生192.168.1.110 00000/27和192.168.1.111 000000/27
将192.168.1.192/27分给工程部，该部可用IP：192.168.2.192~192.168.1.224
```

### [MAC地址](https://en.wikipedia.org/wiki/Medium_access_control)
（media 、access 、control）
	烧录在网卡芯片上，该地址用来标识网卡，定位主机。
	有：目的MAC地址、源MAC地址
MAC地址的格式：
	48 bit，12个16进制数：
0~9、a~f;
	【前六个为买主代码，后六个为厂商自定义代码】

### 思科IOS基本操作
###### 1.网络设备的管理方式
1）远程登录管理
好处：可以长距离进行管理，同时多人管理（不可同时对同一内容进行管理）。
坏处：不安全

实现的方式：
[Telent](https://en.wikipedia.org/wiki/Telnet)：是一个通过网络传输文本数据抵达目标的技术；
[SSH](https://en.wikipedia.org/wiki/Secure_Shell)：目前用来取代Telent的技术，

** 二者的区别： **
Telnet基于TCP，明文方式传递文本数据；SSH基于ＲＳＡ非对称密钥机制，保护 telnet数据。
使用场景：目标设备提供一个可以被管理的IP，管理设备只要透过网络抵达即可。
可被管理的设备：路由器、交换机、防火墙、入侵检测或防御系统、网络访问控制系统

** 2）控制线登录管理 **
Console线缆（设备上有console接口），一般不超过3米
好处：安全
坏处：距离受限，不允许多人同时操作
使用场景：设备初次使用时，需要通过控制线登录管理，进行初始配置

**3）应用管理**
APP进行管理，例，思科的ＳＤＭ
好处：易学、视图化，远程多人管理
坏处：教条

**4）ＷＥＢ管理**
[ＳＤＮ](https://en.wikipedia.org/wiki/Software-defined_networking)　软件定义的网络
Python管理开发

**5）电话线拨号管理**

###### 2.思科 华为的 CIL简介

**2.1 CLI的概念**
command line interface 命令行接口

**2.2 思科设备 ＣＬＩ的模式**
１）User mode用户模式：
登录设备后就位于该模式，该模式主要用于进入下一个模式
２）Privilege mode 特权模式
该模式主要用于查看设备的运行状态，或进行Debug测试使用。
该模式也是为了进入下一个模式
3）configure terminal 配置模式
该模式下，管理员利用命令行进行策略配置。
4）配置子模式
进入某一个配置的时候，例，给接口配IP时，进入的是接口模式

**2.3模式提示符和不同模式间切换的方法及步骤**
```
Router>                #这是用户模式提示符
#Enable进入特权模式，exit退出设备登录模式
Switch#                #这是特权模式提示符
#config terminal进入配置模式，disable退回用户模式
Router（config）#      #这是配置模式提示符
#end退回特权模式
```
进入不同模式和退出不同模式，
> 注意，
无论思科或者华为设备，命令行立刻生效。

**2.4网络设备图标**
1）拓扑图 topology
网络的层次化设计图
2）网络设备图标
Router（路由器）
WiFi router（无线路由器）
Switch（交换机）
Firewall（防火墙）
Cloud 云（可以模拟一个网络，Internet）

**2.5 利用console线缆，连接登录设备的操作过程**

步骤一：准备一台笔记本
笔记本最好用用console口（串口），起码拥有USB接口

步骤二：将控制线连接到笔记本和设备上
设备上是console接口，笔记本上利用转接头将控制线连到USB接口，并且还要安装驱动。

步骤三：利用操作系统提供的终端配置管理软件，登录到设备
常用终端管理软件：
Windows自带的：超级终端
第三方：CRT、putty

**！！补充**
PC的参数：
每一秒传递比特的速率：波特率9600；
Data bits ：固定为8；
Stop bits ：固定为1；

**2.6开机配置文件及当前运行文件**
1)开机配置文件： startup-config（文件名）
开机配置文件是管理员完成配置后，通过保存命令创建；
设备重启开机时会尝试找寻该文件，加载配置。
2）当前运行配置文件
管理员敲入的所有策略命令自动保存到这里，但是一旦断电，这些配置都将失效。

**2.7 简单的思科配置实验**
修改主机名
```
Switch（config）#hostname <主机名>
#删除命令行---> no hostname
#华为命令行--->uodo hostname
#重启设备命令行      Reload
#保存配置            write
```

### 以太网通道技术  (Ether channel)

###### 1.EC的定义
链路聚合技术，将最多8个物理接口形成的链路聚合成一条逻辑链路，并且逃过STP的计算。
EC技术将多条物理链路逻辑上捆绑成为一条逻辑链路来解决流量拥挤的问题。

###### 2.EC的分类
2.1）2层EC（常见）
链路是Trunk-link，链路被聚合后就是属于2层EC；
链路并不是Trunk-link，也被聚合；
应用于2层switch与多层switch；

2.2）3层EC
链路通过命令行从2层生成3层，链路聚合后，形成逻辑接口，给逻辑接口添加IP地址；
只应用于多层switch。

###### 3.EC的实现

3.1）手动配置
管理员指定	物理接口聚会成以太网通道；

3.2）协议协商
管理员设定物理接口协商参数，通过协商物理接口决定是否聚合；

3.2.1）公开标准协议LACP（链路聚合控制协议）
active:主动
Passive：被动
3.2.2）Cisco私有标准
PAGP（端口聚合控制协议）
disriable:期望
auto:自动

###### 4.EC的配置（参考CCNP switch P186）
4.1）2层EC的手动实现
```
interface range <接口名>   //接口名fa0/1-18
shutdown
channel-group <组名> mode on
 //组名编号，组名是最终聚合而来的逻辑编号
Switchport trunk encapsulation <dot1q/isl>
Switchport mode trunk
No shutdown
```

4.2)协议协商
```
interface range <接口名>
shutdown
channel-group <组号> mode on
channel-group <组号> protocol <pagp/lacp>
channel-group <组号> mode <active/passive>
switchport trunk encapsulation <dot1q/isl>
switchport mode trunk
no showdown
```
4.3) 3层EC的实现
```
Interface range <接口名>
Shutdown
Channel-group <组号> mode on
channel-group <组号> protocol <pagp/lacp>
Channel-group <组号> mode <active/passive>
no switchport
no shutdown
Interface port-channel <组号>
No switchport 
Ip address <IP地址> <掩码>
查看以太网通道接口
Show etherchannel summary
//查看以太网通道接口
```









